<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emma Mobile UI Test</title>
  
  <!-- Emma Core Systems -->
  <script src="js/emma-input-modal.js"></script>
  <script src="js/clean-password-modal.js"></script>
  <script src="js/emma-web-vault.js"></script>
  
  <!-- Browser Compatibility Layer -->
  <script src="emma-browser-compatibility-fix.js"></script>
  
  <!-- Mobile UI Fixes -->
  <script src="emma-mobile-ui-fixes.js"></script>
  
  <!-- Emma Orb System -->
  <script src="js/base-orb.js"></script>
  <script src="js/emma-orb.js"></script>
  
  <!-- Experience Systems -->
  <script src="js/experience-popup-base.js"></script>
  <script src="js/emma-chat-experience.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      color: white;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
    }
    
    .test-section {
      margin: 30px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .test-button {
      background: linear-gradient(135deg, #8B5CF6, #F093FB);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin: 10px;
      min-width: 44px;
      min-height: 44px;
    }
    
    .test-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }
    
    .device-info {
      background: rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      font-family: monospace;
      font-size: 12px;
    }
    
    .orb-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 20px auto;
      background: radial-gradient(circle at 30% 30%, #8B5CF6, #764ba2, #F093FB);
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .orb-container:hover {
      transform: scale(1.05);
    }
    
    .radial-menu-test {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 20px auto;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .test-radial-item {
      position: absolute;
      width: 60px;
      height: 60px;
      background: rgba(139, 92, 246, 0.3);
      border: 2px solid rgba(139, 92, 246, 0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 20px;
    }
    
    .test-radial-item:hover {
      background: rgba(139, 92, 246, 0.6);
      transform: scale(1.1);
    }
    
    @media (max-width: 768px) {
      .test-container {
        padding: 15px;
        margin: 10px;
      }
      
      .test-section {
        padding: 15px;
      }
      
      .orb-container {
        width: 150px;
        height: 150px;
      }
      
      .radial-menu-test {
        width: 250px;
        height: 250px;
      }
      
      .test-radial-item {
        width: 50px;
        height: 50px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üì± Emma Mobile UI Test</h1>
    <p>Testing mobile responsiveness and UI fixes</p>
    
    <div class="device-info" id="deviceInfo">
      <strong>Device Information:</strong><br>
      <span id="deviceDetails">Loading...</span>
    </div>
    
    <div class="test-section">
      <h3>üåê Browser Compatibility</h3>
      <p>Testing browser compatibility layer and feature detection</p>
      <button class="test-button" onclick="testBrowserCompatibility()">
        üß™ Test Browser Features
      </button>
      <div id="compatibilityResults" style="margin-top: 15px;"></div>
    </div>
    
    <div class="test-section">
      <h3>üí¨ Chat UI Responsiveness</h3>
      <p>Testing chat modal sizing and mobile responsiveness</p>
      <button class="test-button" onclick="testChatUI()">
        üí¨ Open Chat (Test Mobile Size)
      </button>
      <button class="test-button" onclick="testChatUIDesktop()">
        üí¨ Open Chat (Force Desktop Size)
      </button>
    </div>
    
    <div class="test-section">
      <h3>üéØ Orb Menu Positioning</h3>
      <p>Testing radial menu anchoring to orb center</p>
      <div class="radial-menu-test" id="testRadialMenu">
        <div class="orb-container" onclick="toggleTestRadialMenu()">
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            Click Me
          </div>
        </div>
        <div class="test-radial-item" style="display: none;" data-angle="0">üìù</div>
        <div class="test-radial-item" style="display: none;" data-angle="1">üë•</div>
        <div class="test-radial-item" style="display: none;" data-angle="2">üí¨</div>
        <div class="test-radial-item" style="display: none;" data-angle="3">üîç</div>
      </div>
      <button class="test-button" onclick="testRadialPositioning()">
        üéØ Test Radial Positioning
      </button>
    </div>
    
    <div class="test-section">
      <h3>üìè Viewport Information</h3>
      <div id="viewportInfo">
        <div><strong>Viewport Size:</strong> <span id="viewportSize">-</span></div>
        <div><strong>Device Pixel Ratio:</strong> <span id="devicePixelRatio">-</span></div>
        <div><strong>Orientation:</strong> <span id="orientation">-</span></div>
        <div><strong>Touch Support:</strong> <span id="touchSupport">-</span></div>
      </div>
      <button class="test-button" onclick="updateViewportInfo()">
        üîÑ Refresh Info
      </button>
    </div>
    
    <div class="test-section">
      <h3>üîß Mobile UI Fixes Status</h3>
      <div id="mobileFixesStatus">
        <div><strong>Mobile Fixes Loaded:</strong> <span id="mobileFixesLoaded">-</span></div>
        <div><strong>Browser Compatibility:</strong> <span id="browserCompatibility">-</span></div>
        <div><strong>Device Classification:</strong> <span id="deviceClassification">-</span></div>
      </div>
      <button class="test-button" onclick="checkMobileFixesStatus()">
        ‚úÖ Check Status
      </button>
    </div>
  </div>

  <script>
    // Test functions
    let testRadialMenuOpen = false;
    
    function updateDeviceInfo() {
      const info = {
        userAgent: navigator.userAgent,
        viewport: `${window.innerWidth}x${window.innerHeight}`,
        screen: `${screen.width}x${screen.height}`,
        devicePixelRatio: window.devicePixelRatio || 1,
        orientation: window.innerWidth > window.innerHeight ? 'landscape' : 'portrait',
        touchSupport: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
        isMobile: window.innerWidth <= 768,
        isTablet: window.innerWidth > 768 && window.innerWidth <= 1024
      };
      
      document.getElementById('deviceDetails').innerHTML = `
        <strong>User Agent:</strong> ${info.userAgent}<br>
        <strong>Viewport:</strong> ${info.viewport}<br>
        <strong>Screen:</strong> ${info.screen}<br>
        <strong>Device Pixel Ratio:</strong> ${info.devicePixelRatio}<br>
        <strong>Orientation:</strong> ${info.orientation}<br>
        <strong>Touch Support:</strong> ${info.touchSupport}<br>
        <strong>Is Mobile:</strong> ${info.isMobile}<br>
        <strong>Is Tablet:</strong> ${info.isTablet}
      `;
    }
    
    function testBrowserCompatibility() {
      const results = document.getElementById('compatibilityResults');
      let html = '<div style="font-family: monospace; font-size: 12px;">';
      
      // Test File System Access API
      const hasFileSystemAccess = 'showOpenFilePicker' in window;
      html += `<div style="color: ${hasFileSystemAccess ? '#10b981' : '#ef4444'};">
        ${hasFileSystemAccess ? '‚úÖ' : '‚ùå'} File System Access API: ${hasFileSystemAccess}
      </div>`;
      
      // Test Web Crypto API
      const hasWebCrypto = !!(window.crypto && window.crypto.subtle);
      html += `<div style="color: ${hasWebCrypto ? '#10b981' : '#ef4444'};">
        ${hasWebCrypto ? '‚úÖ' : '‚ùå'} Web Crypto API: ${hasWebCrypto}
      </div>`;
      
      // Test IndexedDB
      const hasIndexedDB = !!window.indexedDB;
      html += `<div style="color: ${hasIndexedDB ? '#10b981' : '#ef4444'};">
        ${hasIndexedDB ? '‚úÖ' : '‚ùå'} IndexedDB: ${hasIndexedDB}
      </div>`;
      
      // Test localStorage
      const hasLocalStorage = !!window.localStorage;
      html += `<div style="color: ${hasLocalStorage ? '#10b981' : '#ef4444'};">
        ${hasLocalStorage ? '‚úÖ' : '‚ùå'} localStorage: ${hasLocalStorage}
      </div>`;
      
      html += '</div>';
      results.innerHTML = html;
    }
    
    function testChatUI() {
      // Test mobile-responsive chat
      const position = {
        left: window.innerWidth <= 768 ? 10 : (window.innerWidth - 600) / 2,
        top: window.innerWidth <= 768 ? 20 : (window.innerHeight - 700) / 2,
        width: window.innerWidth <= 768 ? window.innerWidth - 20 : 600,
        height: window.innerWidth <= 768 ? window.innerHeight - 40 : 700
      };
      
      console.log('üì± Testing chat UI with mobile-responsive positioning:', position);
      
      if (window.EmmaChatExperience) {
        const chat = new window.EmmaChatExperience(position, {
          contextAware: true,
          memoryIntegration: false // Skip vault integration for test
        });
        
        chat.show().catch(error => {
          console.error('Failed to show chat:', error);
          alert('Chat test failed. Check console for details.');
        });
      } else {
        alert('EmmaChatExperience not loaded. Please check script loading.');
      }
    }
    
    function testChatUIDesktop() {
      // Force desktop sizing for comparison
      const position = {
        left: (window.innerWidth - 600) / 2,
        top: (window.innerHeight - 700) / 2,
        width: 600,
        height: 700
      };
      
      console.log('üñ•Ô∏è Testing chat UI with desktop positioning:', position);
      
      if (window.EmmaChatExperience) {
        const chat = new window.EmmaChatExperience(position, {
          contextAware: true,
          memoryIntegration: false
        });
        
        chat.show().catch(error => {
          console.error('Failed to show chat:', error);
          alert('Chat test failed. Check console for details.');
        });
      } else {
        alert('EmmaChatExperience not loaded. Please check script loading.');
      }
    }
    
    function toggleTestRadialMenu() {
      const items = document.querySelectorAll('.test-radial-item');
      const container = document.getElementById('testRadialMenu');
      const containerRect = container.getBoundingClientRect();
      const centerX = containerRect.width / 2;
      const centerY = containerRect.height / 2;
      
      const radius = window.innerWidth <= 768 ? 80 : 100;
      
      testRadialMenuOpen = !testRadialMenuOpen;
      
      items.forEach((item, i) => {
        if (testRadialMenuOpen) {
          const angle = (i / items.length) * Math.PI * 2 - Math.PI / 2;
          const x = centerX + Math.cos(angle) * radius;
          const y = centerY + Math.sin(angle) * radius;
          
          item.style.display = 'flex';
          item.style.left = (x - 30) + 'px'; // Center the 60px item
          item.style.top = (y - 30) + 'px';
          item.style.opacity = '1';
          item.style.transform = 'scale(1)';
          
          console.log(`üéØ TEST: Positioned item ${i} at angle ${angle} -> (${x}, ${y})`);
        } else {
          item.style.opacity = '0';
          item.style.transform = 'scale(0)';
          setTimeout(() => {
            item.style.display = 'none';
          }, 300);
        }
      });
    }
    
    function testRadialPositioning() {
      // Test the actual radial positioning logic
      const container = document.getElementById('testRadialMenu');
      const items = document.querySelectorAll('.test-radial-item');
      
      console.log('üéØ Testing radial positioning logic...');
      console.log('Container:', container.getBoundingClientRect());
      console.log('Items count:', items.length);
      console.log('Mobile mode:', window.innerWidth <= 768);
      
      // Show the test menu
      if (!testRadialMenuOpen) {
        toggleTestRadialMenu();
      }
      
      // Log positioning details
      items.forEach((item, i) => {
        const rect = item.getBoundingClientRect();
        console.log(`Item ${i}:`, {
          position: item.style.left + ', ' + item.style.top,
          rect: `${rect.left}, ${rect.top}`,
          size: `${rect.width}x${rect.height}`
        });
      });
    }
    
    function updateViewportInfo() {
      document.getElementById('viewportSize').textContent = `${window.innerWidth}x${window.innerHeight}`;
      document.getElementById('devicePixelRatio').textContent = window.devicePixelRatio || 1;
      document.getElementById('orientation').textContent = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
      document.getElementById('touchSupport').textContent = 'ontouchstart' in window || navigator.maxTouchPoints > 0 ? 'Yes' : 'No';
    }
    
    function checkMobileFixesStatus() {
      const mobileFixesLoaded = !!window.emmaMobileUIFixes;
      const browserCompatibility = !!window.emmaBrowserCompatibility;
      const deviceClassification = mobileFixesLoaded ? 
        (window.emmaMobileUIFixes.isMobile ? 'Mobile' : 
         window.emmaMobileUIFixes.isTablet ? 'Tablet' : 'Desktop') : 'Unknown';
      
      document.getElementById('mobileFixesLoaded').textContent = mobileFixesLoaded ? 'Yes' : 'No';
      document.getElementById('browserCompatibility').textContent = browserCompatibility ? 'Yes' : 'No';
      document.getElementById('deviceClassification').textContent = deviceClassification;
      
      if (mobileFixesLoaded) {
        console.log('üì± Mobile UI Fixes Debug Info:', window.emmaMobileUIFixes.getDebugInfo());
      }
    }
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      updateDeviceInfo();
      updateViewportInfo();
      
      // Update info on resize and orientation change
      window.addEventListener('resize', () => {
        setTimeout(() => {
          updateDeviceInfo();
          updateViewportInfo();
        }, 100);
      });
      
      window.addEventListener('orientationchange', () => {
        setTimeout(() => {
          updateDeviceInfo();
          updateViewportInfo();
        }, 300);
      });
      
      // Check status after mobile fixes load
      setTimeout(() => {
        checkMobileFixesStatus();
        testBrowserCompatibility();
      }, 1000);
    });
  </script>
</body>
</html>
