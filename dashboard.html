<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emma - Your Intelligent Memory Companion</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml">

  <!-- Cache busting meta tags -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- Load Emma Core Systems -->
  <script src="js/emma-env.js"></script>
  <script src="js/emma-logger.js"></script>
  <script src="js/modal-manager.js"></script>
  <script src="js/emma-dementia-modals.js"></script>
  <script src="js/emma-font-scaler.js"></script>
  <script src="js/emma-performance-optimizer.js"></script>
  <!-- Removed universal-emma-orb-menu.js - keeping clean original system -->
  
  <!-- Load Emma Web Vault System -->
  <script src="js/emma-input-modal.js"></script>
  <script src="js/clean-password-modal.js"></script>
  <script src="js/modal-helpers.js"></script>
  <script src="js/emma-feature-flags.js"></script>
  <script src="js/emma-vault-primary.js"></script>
  <script src="js/emma-web-vault.js"></script>
  <script src="js/web-vault-status.js"></script>

  <!-- WEBAPP-FIRST ARCHITECTURE: Communication bridge -->
  <script src="js/webapp-extension-bridge.js"></script>

    <!-- Browser Compatibility Layer - PRODUCTION: Removed for clean deployment -->
  <!-- <script src="emma-browser-compatibility-fix.js"></script> -->
  
  <!-- Mobile UI Fixes - PRODUCTION: Removed for clean deployment -->
  <!-- <script src="emma-mobile-ui-fixes.js"></script> -->

  <!-- Theme system -->
  <link rel="stylesheet" href="css/theme-tokens.css">
  <link rel="stylesheet" href="css/emma-components.css">

  <!-- VAULT STATE MONITOR: Real-time auto-lock detection -->
  <script src="emma-vault-extension-fixed/vault-state-monitor.js"></script>

  <!-- Theme catalog and manager -->
  <script src="themes/theme-catalog.js"></script>
  <script src="js/theme-manager.js"></script>

  <!-- Dashboard base styles -->
  <link rel="stylesheet" href="css/dashboard-base.css">

</head>
<body>
  <!-- Aurora Background -->
  <div class="aurora-bg">
    <div class="aurora"></div>
  </div>

  <!-- Memory Constellation Canvas -->
  <canvas id="constellation" class="constellation-canvas"></canvas>

  <!-- Welcome Text -->
  <div class="welcome-text">
    <h1 class="welcome-title">emma</h1>
    <p class="welcome-subtitle">Your Intelligent Memory Companion</p>
  </div>

  <!-- Neural Network Background -->
  <div class="neural-network">
    <canvas id="neural-canvas" class="neural-canvas"></canvas>
  </div>

  <!-- Main Dashboard -->
  <div class="dashboard">
    <div class="command-center">
      <!-- Central Emma Orb (WebGL) with Elegant Vault Unlock -->
      <div class="emma-orb-container" id="emma-orb">
        <div class="emma-orb-webgl" id="webgl-orb-container">
          <!-- WebGL Emma Orb will be inserted here -->
        </div>
      </div>
      
      <!-- Removed Universal Orb Menu - keeping clean original system -->
    </div>
  </div>

  <!-- Radial Menu (Clean 3-item triangle layout around Emma orb) -->
  <div class="radial-menu" id="radial-menu">
    <div class="radial-item" data-action="memories">
      <div class="radial-item-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-2.5 2.5M6.5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H6.5z"/>
          <path d="M9 10h6M9 14h4"/>
        </svg>
      </div>
      <div class="radial-item-label">Memories</div>
    </div>
    <div class="radial-item" data-action="people">
      <div class="radial-item-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="8" r="5"/>
          <path d="M20 21a8 8 0 1 0-16 0"/>
        </svg>
      </div>
      <div class="radial-item-label">People</div>
    </div>
    <div class="radial-item" data-action="chat">
      <div class="radial-item-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
      </div>
      <div class="radial-item-label">Chat</div>
    </div>
  </div>



  <!-- Bottom Left Clean Icons -->
  <div class="clean-icons">
    <!-- Clean Settings Gear Icon -->
    <button
      type="button"
      class="emma-floating-button settings-button"
      data-action="navigate-settings"
      aria-label="Open Settings"
      title="Settings"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
      </svg>
    </button>
  </div>

      <!-- Quick Stats -->
      <div class="quick-stats">
        <div class="stat-item" data-stat="memories">
          <div class="stat-value" id="stat-memories">0</div>
          <div class="stat-label">Memories</div>
        </div>
        <div class="stat-item" data-stat="people">
          <div class="stat-value" id="stat-people">0</div>
          <div class="stat-label">People</div>
        </div>

        <!-- Revolutionary Migration Button -->
        <div class="stat-item revolution-upgrade" data-action="open-migration" style="background: linear-gradient(135deg, rgba(111, 99, 217, 0.2), rgba(208, 111, 168, 0.2)); border: 2px solid rgba(111, 99, 217, 0.4); cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;">
          <div class="stat-value" style="font-size: 1.2rem; color: #6f63d9;">ğŸŒŸ</div>
          <div class="stat-label" style="color: #d06fa8; font-weight: 600; font-size: 0.8rem;">Upgrade to .emma</div>
          <div style="position: absolute; top: 4px; right: 4px; background: linear-gradient(135deg, #6f63d9, #d06fa8); color: white; font-size: 0.6rem; padding: 2px 6px; border-radius: 8px; font-weight: 600;">NEW</div>
        </div>
        <div class="stat-item" data-stat="today">
          <div class="stat-value" id="stat-today">0</div>
          <div class="stat-label">Today</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Burger menu removed for clean interface -->

  <!-- Right Side Panel Stack -->
  <div class="info-panel right-stack" id="daily-brief">
    <div class="panel-header">
      <div class="panel-icon">ğŸ“…</div>
      <div class="panel-title">Daily Brief</div>
    </div>
    <div class="panel-content">
      <p>Good morning! You have 3 memories from this day last year.</p>
      <p style="margin-top: 12px; font-size: 13px; opacity: 0.8;">
        â€¢ Meeting with Sarah about the project<br>
        â€¢ Family dinner at Marina Bay<br>
        â€¢ Completed the meditation course
      </p>
    </div>
  </div>

  <div class="info-panel right-stack" id="ai-insights">
    <div class="panel-header">
      <div class="panel-icon">ğŸ’¡</div>
      <div class="panel-title">AI Insights</div>
    </div>
    <div class="panel-content">
      <p>I noticed you've been capturing more creative moments lately. Your photography memories have increased by 40% this month!</p>
    </div>
  </div>

  <div class="info-panel right-stack" id="quick-actions">
    <div class="panel-header">
      <div class="panel-icon">âš¡</div>
      <div class="panel-title">Quick Actions</div>
    </div>
    <div class="panel-content">
      <p>Press <kbd>Space</kbd> to activate voice capture<br>
      Press <kbd>Cmd+K</kbd> to search memories<br>
      Say "Hey Emma" to start</p>
    </div>
  </div>

  <!-- Voice Indicator -->
  <div class="voice-indicator" id="voice-indicator">
    <div class="voice-waves">
      <div class="voice-wave"></div>
      <div class="voice-wave"></div>
      <div class="voice-wave"></div>
      <div class="voice-wave"></div>
      <div class="voice-wave"></div>
    </div>
    <span>Listening...</span>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading">
    <div class="loading-content">
      <div class="loading-orb"></div>
      <p style="color: var(--emma-text-secondary);">Loading Emma...</p>
    </div>
  </div>

  <!-- Vault Management Modal -->
  <div id="vault-modal" class="vault-modal" style="display: none;">
    <div class="vault-modal-content">
      <div class="vault-modal-header">
        <div class="vault-header-content">
          <div class="vault-icon">ğŸ”</div>
          <div class="vault-title">
            <h2>Emma Memory Vault</h2>
            <p id="vault-subtitle">Secure access to your encrypted memories</p>
          </div>
        </div>
        <button class="vault-close" id="close-vault-modal">Ã—</button>
      </div>

      <div class="vault-modal-body">
        <!-- Vault Status Section -->
        <div class="vault-status-section">
          <div class="vault-status-card" id="vault-status-card">
            <div class="status-icon" id="status-icon">ğŸ”’</div>
            <div class="status-info">
              <h3 id="status-title">Vault Locked</h3>
              <p id="status-description">Enter your vault code to access your memories</p>
            </div>
            <div class="status-action">
              <button id="vault-action-btn" class="vault-btn primary">Unlock Vault</button>
            </div>
          </div>
        </div>

        <!-- Unlock Form Section -->
        <div class="vault-unlock-section" id="unlock-section" style="display: none;">
          <div class="unlock-form">
            <label for="vault-password">Vault Code</label>
            <input type="password" id="vault-password" placeholder="Enter your vault code" autocomplete="current-password">
            <div class="unlock-actions">
              <button id="unlock-btn" class="vault-btn primary">ğŸ”“ Unlock</button>
              <button id="cancel-unlock-btn" class="vault-btn secondary">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Create New Vault Section -->
        <div class="vault-create-section" id="create-vault-section" style="display: none;">
          <div class="create-vault-card">
            <div class="create-vault-icon">ğŸ†•</div>
            <div class="create-vault-content">
              <h3>No Vault Found</h3>
              <p>Create your first Emma memory vault to get started</p>
              <button id="create-vault-btn" class="vault-btn primary">
                ğŸ” Create New Vault
              </button>
            </div>
          </div>
        </div>

        <!-- QR Sharing Section -->
        <div class="vault-qr-section" id="qr-section">
          <h3>ğŸ“± Quick Share</h3>
          <p>Generate QR codes to securely share your vault or memories</p>

          <div class="qr-options">
            <div class="qr-option-card" id="generate-vault-qr-dashboard">
              <div class="qr-option-icon">ğŸ”</div>
              <div class="qr-option-content">
                <h4>Share Vault</h4>
                <p>Time-limited access to your vault</p>
              </div>
              <div class="qr-option-action">
                <button class="vault-btn secondary small">Generate QR</button>
              </div>
            </div>

            <div class="qr-option-card" id="open-qr-scanner-dashboard">
              <div class="qr-option-icon">ğŸ“·</div>
              <div class="qr-option-content">
                <h4>Scan QR Code</h4>
                <p>Access shared memories</p>
              </div>
              <div class="qr-option-action">
                <button class="vault-btn secondary small">Open Scanner</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="vault-actions-section">
          <div class="quick-actions-grid">
            <button class="quick-action" data-action="open-gallery">
              <span>ğŸ’</span>
              <span>View Memory Constellation</span>
            </button>
            <button class="quick-action" data-action="navigate-settings">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: rgba(255, 255, 255, 0.8);">
                <circle cx="12" cy="12" r="3"/>
                <path d="m12 1 1.09 3.26L16 5.64l-1.64 3.36L17 12l-2.64 2.64L16 18.36l-3.26-1.09L12 23l-1.09-3.26L8 18.36l1.64-3.36L7 12l2.64-2.64L8 5.64l3.26 1.09z"/>
              </svg>
              <span>Settings</span>
            </button>
            <button class="quick-action" data-action="open-people">
              <span>ğŸ‘¥</span>
              <span>People</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Load all your beautiful Emma components! -->
  <link rel="stylesheet" href="css/voice-capture-minimal.css">
  <link rel="stylesheet" href="css/emma-chat-clean.css">
  <link rel="stylesheet" href="css/emma-share.css">

  <script src="js/base-orb.js"></script>
  <script src="js/emma-orb.js"></script>
  <script src="js/vault-control-panel.js"></script>
  <script src="js/experience-popup-base.js"></script>
  <script src="js/voice-capture-experience.js"></script>
  <script src="js/emma-voice-transcription.js"></script>
  
  <!-- Emma Intelligence & Chat System -->
  <script src="js/memory-context-analyzer.js"></script>
  <script src="js/memory-orchestrator.js"></script>
  <script src="js/emma-vectorless-engine.js"></script>
  <script src="js/emma-intelligent-capture.js"></script>
  <script src="js/ui/chat-ui.js"></script>
  <script src="js/emma-chat-experience.js"></script>
  <script src="js/emma-qr-generator.js"></script>
  
  <!-- ğŸ™ï¸ Emma Voice Integration - Server-Side Agent -->
  <script src="js/emma-realtime-voice.js"></script>
  <script src="js/emma-browser-client.js"></script>
  <link rel="stylesheet" href="css/emma-voice-chat.css">
  <script src="js/qr-service.js"></script>
  <script src="js/emma-share-experience.js"></script>
  <script src="js/assistant-experience-popup.js"></script>
  <script src="js/universal-vault-modal.js"></script>
  <script src="js/unified-memory-wizard.js"></script>

<script src="js/dashboard-init.js"></script>
</body>
</html>
