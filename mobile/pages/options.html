           </div>
          <div class="setting-section" style="margin-top:16px;">
            <div class="setting-item">
              <div class="setting-label">
                <strong>Quick Unlock (Biometrics)</strong>
                <small>Use Face ID/Touch ID or fingerprint to unlock faster. Passphrase is still required for exports and key changes.</small>
              </div>
              <label class="toggle">
                <input type="checkbox" id="biometrics-toggle">
                <span class="slider"></span>
              </label>
            </div>
          </div>
          <div id="backup-status" class="backup-status" style="margin-top:12px;"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script src="../js/vault/backup-control.js"></script>
  <script src="../js/vault/biometrics.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Backup toggle
      const backupToggle = document.getElementById('backup-exclusion-toggle');
      if (backupToggle && window.EmmaBackupControl) {
        try { backupToggle.checked = !!window.EmmaBackupControl.getBackupExcluded(); } catch {}
        backupToggle.addEventListener('change', async () => {
          try {
            const res = await window.EmmaBackupControl.setBackupExcluded(backupToggle.checked);
            notify('Vault backup setting updated' + (res.native ? '' : ' (native flag not available here)'));
          } catch (e) {
            notify('Failed to update backup setting: ' + e.message, true);
            backupToggle.checked = !backupToggle.checked;
          }
        });
      }

      // Biometrics toggle
      const bioToggle = document.getElementById('biometrics-toggle');
      if (bioToggle && window.EmmaBiometrics) {
        try { bioToggle.checked = !!window.EmmaBiometrics.getEnabled(); } catch {}
        bioToggle.addEventListener('change', async () => {
          try {
            if (bioToggle.checked) {
              await window.EmmaBiometrics.enableQuickUnlock();
              notify('Quick unlock enabled');
            } else {
              await window.EmmaBiometrics.disableQuickUnlock();
              notify('Quick unlock disabled');
            }
          } catch (e) {
            notify('Biometrics error: ' + e.message, true);
            bioToggle.checked = !bioToggle.checked;
          }
        });
      }

      document.getElementById('settings-close')?.addEventListener('click', () => history.back());

      function notify(msg, isError) {
        const n = document.getElementById('notification');
        if (!n) return;
        n.textContent = msg;
        n.className = 'notification show ' + (isError ? 'error' : 'success');
        setTimeout(() => n.classList.remove('show'), 2000);
      }
    });
  </script>
</body>
</html>