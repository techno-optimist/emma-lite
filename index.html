<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emma - Your Intelligent Memory Companion</title>
  <link rel="stylesheet" href="css/dashboard-secure.css">
  <style>
    /* Web App Enhancements - Preserving Emma's Beauty */
    .emma-web-launcher {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10000;
      background: var(--emma-glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--emma-border);
      border-radius: 20px;
      padding: 40px 40px 28px 40px;
      text-align: center;
      box-shadow: var(--emma-glow);
      max-width: 520px;
      width: 90%;
    }

    .emma-logo {
      font-size: 2.2rem;
      background: var(--emma-gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-top: 8px;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .emma-subtitle {
      color: var(--emma-text-secondary);
      margin-bottom: 22px;
      font-size: 1rem;
      line-height: 1.5;
    }

    /* Extension Detection Banner */
    .extension-banner {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      padding: 16px 24px;
      border-radius: 16px;
      margin-bottom: 20px;
      text-align: center;
      display: none;
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
      transition: all 0.3s ease;
    }
    
    .extension-banner:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .extension-banner.show {
      display: block;
    }

    .extension-banner h3 {
      margin: 0 0 8px 0;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .extension-banner p {
      margin: 0;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .extension-banner .extension-icon {
      font-size: 1.5rem;
      margin-right: 8px;
    }

    /* No Extension Warning */
    .no-extension-warning {
      background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
      color: white;
      padding: 16px 24px;
      border-radius: 16px;
      margin-bottom: 20px;
      text-align: center;
      display: none;
      box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
    }

    .no-extension-warning.show {
      display: block;
    }

    .install-extension-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      margin-top: 12px;
      text-decoration: none;
      display: inline-block;
    }

    .install-extension-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Orb inside the drop zone */
    #emmaOrbInDrop {
      width: 84px;
      height: 84px;
      margin: 0 auto 10px auto;
      pointer-events: none; /* keep the drop zone clickable */
    }

    .emma-vault-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }

    .emma-vault-btn {
      padding: 15px 30px;
      border: 2px solid transparent;
      border-radius: 12px;
      background: var(--emma-gradient-2);
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .emma-vault-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(134, 88, 255, 0.3);
    }

    .emma-vault-btn.secondary {
      background: transparent;
      border: 2px solid var(--emma-border);
      color: var(--emma-text);
    }

    .emma-vault-btn.secondary:hover {
      border-color: var(--emma-purple);
      background: rgba(134, 88, 255, 0.1);
    }

    .emma-file-drop {
      margin-top: 20px;
      padding: 20px;
      border: 2px dashed var(--emma-border);
      border-radius: 12px;
      color: var(--emma-text-tertiary);
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .emma-file-drop.dragover {
      border-color: var(--emma-purple);
      background: rgba(134, 88, 255, 0.05);
      color: var(--emma-text);
    }

    .emma-hidden {
      display: none !important;
    }

    .emma-dedication {
      position: fixed;
      bottom: 20px;
      right: 20px;
      color: var(--emma-text-tertiary);
      font-size: 0.8rem;
      font-style: italic;
      text-align: right;
      line-height: 1.4;
    }

    .emma-dedication .heart {
      color: var(--emma-pink);
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <!-- Aurora Background (Preserving Beauty) -->
  <div class="aurora-bg">
    <div class="aurora-layer aurora-1"></div>
    <div class="aurora-layer aurora-2"></div>
    <div class="aurora-layer aurora-3"></div>
  </div>

  <!-- Web App Launcher -->
  <div class="emma-web-launcher" id="emmaLauncher">
    
    <!-- Extension Detection Banner -->
    <div class="extension-banner" id="extensionDetectedBanner">
      <h3><span class="extension-icon">üîó</span>Emma Vault Extension Detected!</h3>
      <p>Your extension will automatically save all changes to your local .emma file</p>
    </div>

    <!-- No Extension Warning -->
    <div class="no-extension-warning" id="noExtensionWarning">
      <h3><span class="extension-icon">‚ö†Ô∏è</span>Get the Emma Vault Extension</h3>
      <p>Install our extension to automatically save changes to your local .emma file</p>
      <a href="#" class="install-extension-btn" onclick="showExtensionInstallGuide()">Install Extension</a>
    </div>
    
    <!-- Emma Orb will render inside the drop zone -->
    <div class="emma-logo">Emma</div>
    <div class="emma-subtitle">
      Your Intelligent Memory Companion<br>
      <span style="opacity:0.85">.emma Vault ‚Äî simple, secure, yours</span>
    </div>

    <!-- Drag & Drop Zone -->
    <div class="emma-drop-zone" id="emmaDropZone" style="
      border: 2px dashed rgba(255, 255, 255, 0.3);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 20px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    " onclick="openExistingVault()">
      <div id="emmaOrbInDrop"></div>
      <div style="color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 4px;">
        Open .emma Vault
      </div>
      <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.95rem;">
        Choose your vault file. Emma will save changes automatically.
      </div>
    </div>

    <div class="emma-vault-buttons">
      <button class="emma-vault-btn" onclick="createNewVault()">
        üåü Create New Vault
      </button>
    </div>

    <!-- Recent .emma files section -->
    <div id="recentVaults" style="margin-top: 30px;">
      <h3 style="color: rgba(255, 255, 255, 0.8); margin-bottom: 15px; text-align: center;">üìã Recent Vaults</h3>
      <div id="recentVaultsList" style="display: flex; flex-direction: column; gap: 10px;"></div>
    </div>





    <input type="file" id="fileInput" accept=".emma" style="display: none;">
  </div>

  <!-- Main App Container (Hidden until vault is loaded) -->
  <div id="mainApp" class="emma-hidden">
    <!-- This will be populated with dashboard content -->
  </div>

  <!-- Dedication -->
  <div class="emma-dedication">
    Built with <span class="heart">‚ô°</span> for preserving precious memories<br>
    In honor of all mothers and their irreplaceable stories
  </div>

  <!-- Core Emma Web Vault System -->
  <script src="js/emma-input-modal.js"></script>
  <script src="js/clean-password-modal.js"></script>
  <script src="js/emma-orb.js"></script>
  <script src="js/emma-web-vault.js"></script>
  <script src="js/universal-vault-modal.js"></script>
  
  <script>
    console.log('üíú Emma Web App - Preserving Memories with Love');
    
    // Check for Emma Vault Extension
    checkForExtension();
    
    // Initialize top-center Emma Orb
    try {
      const orbHost = document.getElementById('emmaOrbInDrop');
      if (orbHost && window.EmmaOrb) {
        new window.EmmaOrb(orbHost, {
          hue: 270,
          hoverIntensity: 0.3,
          rotateOnHover: false,
          forceHoverState: true
        });
      }
    } catch (e) { console.warn('Emma orb init skipped:', e); }

    // Debug: Check if all components are loaded
    setTimeout(() => {
      console.log('üîç Component availability check:');
      console.log('- emmaInputModal:', window.emmaInputModal ? '‚úÖ Available' : '‚ùå Missing');
      console.log('- securePasswordModal:', window.securePasswordModal ? '‚úÖ Available' : '‚ùå Missing');
      console.log('- emmaWebVault:', window.emmaWebVault ? '‚úÖ Available' : '‚ùå Missing');
    }, 500);

    // Track recent vault files for easy access
    function addToRecentVaults(fileName) {
      try {
        let recent = JSON.parse(localStorage.getItem('emmaRecentVaults') || '[]');
        
        // Remove if already exists (move to top)
        recent = recent.filter(item => item.name !== fileName);
        
        // Add to top with timestamp
        recent.unshift({
          name: fileName,
          timestamp: Date.now(),
          lastOpened: new Date().toLocaleString()
        });
        
        // Keep only last 5
        recent = recent.slice(0, 5);
        
        localStorage.setItem('emmaRecentVaults', JSON.stringify(recent));
        displayRecentVaults();
      } catch (error) {
        console.error('Failed to save recent vault:', error);
      }
    }

    function displayRecentVaults() {
      try {
        const recent = JSON.parse(localStorage.getItem('emmaRecentVaults') || '[]');
        const recentSection = document.getElementById('recentVaults');
        const recentList = document.getElementById('recentVaultsList');
        
        if (recent.length > 0) {
          recentSection.style.display = 'block';
          recentList.innerHTML = recent.map(vault => `
            <button onclick="openRecentVault('${vault.name}')" style="
              background: rgba(255, 255, 255, 0.05);
              border: 1px solid rgba(255, 255, 255, 0.1);
              border-radius: 12px;
              padding: 15px;
              color: white;
              cursor: pointer;
              text-align: left;
              transition: all 0.2s ease;
              width: 100%;
            " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
              <div style="font-weight: bold; margin-bottom: 5px;">üìÅ ${vault.name}</div>
              <div style="font-size: 0.9rem; opacity: 0.7;">Last opened: ${vault.lastOpened}</div>
            </button>
          `).join('');
        } else {
          recentSection.style.display = 'none';
        }
      } catch (error) {
        console.error('Failed to display recent vaults:', error);
      }
    }

    async function openRecentVault(fileName) {
      try {
        console.log('üìÇ Opening recent vault:', fileName);
        // For now, just open the file picker - in future we could try to remember file handles
        fileInput.click();
      } catch (error) {
        console.error('Failed to open recent vault:', error);
      }
    }

    // Display recent vaults on page load
    displayRecentVaults();

    // File input for the drop zone click
    const fileInput = document.getElementById('fileInput');



    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        loadVaultFile(e.target.files[0]);
      }
    });

    // ELEGANT: Add proper drag & drop functionality to the drop zone
    const emmaDropZone = document.getElementById('emmaDropZone');
    
    emmaDropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      e.stopPropagation();
      emmaDropZone.style.borderColor = 'rgba(134, 88, 255, 0.8)';
      emmaDropZone.style.background = 'rgba(134, 88, 255, 0.1)';
      console.log('üéØ ELEGANT: Drag over detected');
    });
    
    emmaDropZone.addEventListener('dragleave', (e) => {
      e.preventDefault();
      e.stopPropagation();
      emmaDropZone.style.borderColor = 'rgba(255, 255, 255, 0.3)';
      emmaDropZone.style.background = 'transparent';
      console.log('üéØ ELEGANT: Drag leave detected');
    });
    
    emmaDropZone.addEventListener('drop', async (e) => {
      e.preventDefault();
      e.stopPropagation();
      emmaDropZone.style.borderColor = 'rgba(255, 255, 255, 0.3)';
      emmaDropZone.style.background = 'transparent';
      
      const files = Array.from(e.dataTransfer.files);
      const emmaFile = files.find(file => file.name.endsWith('.emma'));
      
      if (emmaFile) {
        console.log('üéØ ELEGANT: .emma file dropped:', emmaFile.name);
        
        // Request write permission for seamless updates
        if ('showOpenFilePicker' in window && window.emmaWebVault) {
          try {
            console.log('üîì ELEGANT: Requesting write permission for dropped file...');
            const [fileHandle] = await window.showOpenFilePicker({
              types: [{
                description: 'Emma Vault Files',
                accept: { 'application/emma': ['.emma'] }
              }]
            });
            
            const selectedFile = await fileHandle.getFile();
            if (selectedFile.name === emmaFile.name && selectedFile.size === emmaFile.size) {
              window.emmaWebVault.fileHandle = fileHandle;
              window.emmaWebVault.originalFileName = emmaFile.name;
              sessionStorage.setItem('emmaVaultOriginalFileName', emmaFile.name);
              console.log('‚úÖ ELEGANT: Write access granted for dropped file!');
            }
          } catch (error) {
            console.log('‚ÑπÔ∏è ELEGANT: User declined write access for dropped file, using fallback');
          }
        }
        
        await loadVaultFile(emmaFile);
      } else {
        alert('Please drop a .emma vault file');
      }
    });

    // Vault operations
    async function createNewVault() {
      try {
        console.log('üåü Creating new vault with love...');
        
        // Get vault name with beautiful Emma modal
        console.log('üìù Getting vault name...');
        const vaultName = await window.emmaInputModal.show({
          title: 'üåü Create Memory Vault',
          message: 'Give your memory vault a beautiful name that reflects the precious memories it will hold.',
          placeholder: 'Enter vault name...',
          defaultValue: "My Precious Memories"
        });
        
        console.log('‚úÖ Got vault name:', vaultName);
        
        // Use CLEAN password modal for passphrase
        console.log('üîê Getting secure passphrase...');
        const passwordData = await window.cleanSecurePasswordModal.show({
          title: 'Create Secure Vault',
          message: 'Create a strong passphrase to protect your precious memories. This will encrypt all your data.',
          placeholder: 'Enter secure passphrase...',
          confirmPassword: true
        });
        
        const passphrase = passwordData.password;
        console.log('‚úÖ Got secure passphrase (length:', passphrase.length, ')');
        
        // Create vault using our web system
        console.log('üèóÔ∏è Creating vault file...');
        const result = await window.emmaWebVault.createVaultFile(vaultName, passphrase);
        console.log('‚úÖ Vault creation result:', result);
        
        // Store vault info for dashboard
        console.log('üíæ Storing vault info for dashboard...');
        sessionStorage.setItem('emmaVaultActive', 'true');
        sessionStorage.setItem('emmaVaultName', vaultName);
        
        // Load the main dashboard
        console.log('üöÄ Loading main dashboard...');
        await loadMainApp();
        
        console.log('üéâ New vault created successfully!');
      } catch (error) {
        console.error('‚ùå Failed to create vault:', error);
        
        // Better error handling
        if (error.message === 'Input cancelled' || error.message === 'Password input cancelled') {
          console.log('‚ÑπÔ∏è User cancelled vault creation');
          return; // Don't show error for cancellation
        }
        
        alert(`Failed to create vault: ${error.message}\n\nPlease check the browser console for more details.`);
      }
    }

    async function openExistingVault() {
      try {
        console.log('üìÇ Opening vault with WRITE permission for seamless updates...');
        
        // Use File System Access API to get WRITE permission
        if ('showOpenFilePicker' in window) {
          const [fileHandle] = await window.showOpenFilePicker({
            types: [{
              description: 'Emma Vault Files',
              accept: { 'application/emma': ['.emma'] }
            }]
          });
          
          const file = await fileHandle.getFile();
          console.log('üìÅ Selected file with WRITE ACCESS:', file.name);
          
          // CRITICAL: Store file handle BEFORE loading
          if (window.emmaWebVault) {
            window.emmaWebVault.fileHandle = fileHandle;
            window.emmaWebVault.originalFileName = file.name;
            // CRITICAL: Store filename in session for restoration
            sessionStorage.setItem('emmaVaultOriginalFileName', file.name);
            console.log('‚úÖ ELEGANT: Write access granted - seamless updates enabled!');
            console.log('üíæ ELEGANT: Stored filename for restoration:', file.name);
          }
          
          await loadVaultFile(file);
        } else {
          // Fallback: Use regular file picker (no write access)
          console.log('‚ö†Ô∏è File System Access API not supported - using fallback');
          fileInput.click();
        }
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.error('Error opening vault:', error);
        }
      }
    }

    async function loadVaultFile(file) {
      try {
        console.log('üöÄ ELEGANT: loadVaultFile called with:', file.name, 'size:', file.size);
        
        // Load vault using elegant system (fileHandle already stored if available)
        console.log('üîì ELEGANT: Opening vault file with elegant system...');
        const result = await window.emmaWebVault.openVaultFile(file);
        console.log('‚úÖ ELEGANT: Vault opened successfully, result:', result);
        
        // Add to recent vaults for easy access
        addToRecentVaults(file.name);
        
        // Load the main dashboard
        console.log('üöÄ About to load main dashboard...');
        await loadMainApp();
        
        console.log('‚úÖ Dashboard should be loading now!');
      } catch (error) {
        console.error('‚ùå Failed to load vault:', error);
        console.error('‚ùå Full error details:', error.stack);
        alert('Failed to load vault file. Error: ' + error.message);
      }
    }

    async function loadMainApp() {
      try {
        console.log('üöÄ Loading Emma dashboard...');
        
        // Hide launcher
        document.getElementById('emmaLauncher').style.display = 'none';
        
        // For now, show a simple success message and redirect
        const mainApp = document.getElementById('mainApp');
        mainApp.innerHTML = `
          <div style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
            padding: 40px;
          ">
            <div style="
              background: rgba(255, 255, 255, 0.05);
              backdrop-filter: blur(20px);
              border: 1px solid rgba(255, 255, 255, 0.1);
              border-radius: 20px;
              padding: 40px;
              max-width: 500px;
              box-shadow: 0 0 40px rgba(134, 88, 255, 0.6);
            ">
              <div style="font-size: 4rem; margin-bottom: 20px;">üéâ</div>
              <h1 style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                font-size: 2.5rem;
                margin-bottom: 20px;
              ">Vault Created Successfully!</h1>
              
              <p style="color: rgba(255, 255, 255, 0.8); font-size: 1.2rem; line-height: 1.6; margin-bottom: 30px;">
                Your secure .emma vault file has been created and downloaded!<br>
                <strong>Your precious memories are now protected with military-grade encryption.</strong>
              </p>
              
              <div style="
                background: rgba(74, 222, 128, 0.1);
                border: 1px solid rgba(74, 222, 128, 0.3);
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 30px;
                color: #4ade80;
              ">
                <div style="font-size: 1.5rem; margin-bottom: 10px;">üìÅ</div>
                <strong>Check your Downloads folder</strong><br>
                Your vault file: <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">helloworld.emma</code>
              </div>
              
              <button onclick="continueToFullDashboard()" style="
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #a855f7 100%);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 12px;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
                transition: transform 0.2s;
              " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                üåü Continue to Emma Dashboard
              </button>
              
              <div style="margin-top: 30px; font-size: 0.9rem; color: rgba(255, 255, 255, 0.6);">
                üíú Built with love for preserving precious memories<br>
                Ready to capture your mother's irreplaceable stories
              </div>
            </div>
          </div>
        `;
        mainApp.classList.remove('emma-hidden');
        
        console.log('üíú Emma success page loaded!');
        
        // Automatically redirect to dashboard after 2 seconds
        setTimeout(() => {
          console.log('üöÄ Auto-redirecting to dashboard...');
          continueToFullDashboard();
        }, 2000);
      } catch (error) {
        console.error('‚ùå Failed to load main app:', error);
        alert('Failed to load Emma interface. Please refresh and try again.');
      }
    }
    
    function continueToFullDashboard() {
      // Redirect to the EXACT WORKING DESKTOP DASHBOARD!
      window.location.href = 'working-desktop-dashboard.html';
    }

    // Replace ugly browser prompts with beautiful Emma modals
    window.emmaPrompt = async function(message, defaultValue = '') {
      return await window.emmaInputModal.show({
        title: 'Emma',
        message: message,
        placeholder: 'Enter value...',
        defaultValue: defaultValue
      });
    };

    // Debug function for testing vault creation flow
    async function debugVaultCreation() {
      console.log('üîß DEBUG: Testing vault creation flow...');
      
      try {
        // Test each component step by step
        console.log('üîç Step 1: Checking components...');
        console.log('- emmaInputModal:', window.emmaInputModal ? '‚úÖ' : '‚ùå');
        console.log('- securePasswordModal:', window.securePasswordModal ? '‚úÖ' : '‚ùå');
        console.log('- emmaWebVault:', window.emmaWebVault ? '‚úÖ' : '‚ùå');
        
        if (!window.emmaInputModal) {
          alert('‚ùå emmaInputModal not loaded! Check console for errors.');
          return;
        }
        
        if (!window.securePasswordModal) {
          alert('‚ùå securePasswordModal not loaded! Check console for errors.');
          return;
        }
        
        console.log('üîç Step 2: Testing vault name input...');
        const vaultName = await window.emmaInputModal.show({
          title: 'üîß Debug Test',
          message: 'Testing vault name input - enter anything:',
          placeholder: 'Debug test...',
          defaultValue: "Debug Test Vault"
        });
        console.log('‚úÖ Got vault name:', vaultName);
        
        console.log('üîç Step 3: Testing password input...');
        const passwordData = await window.securePasswordModal.show({
          title: 'üîß Debug Password',
          message: 'Testing password input - enter anything:',
          placeholder: 'Debug password...',
          confirmPassword: true
        });
        console.log('‚úÖ Got password:', passwordData.password.length, 'characters');
        
        console.log('üéâ DEBUG SUCCESS: Both modals are working!');
        alert('üéâ Debug Success! Both modals are working perfectly. The issue might be elsewhere.');
        
      } catch (error) {
        console.error('‚ùå DEBUG FAILED:', error);
        alert(`‚ùå Debug Failed: ${error.message}\n\nCheck the browser console for details.`);
      }
    }

    // Extension Detection Functions
    function checkForExtension() {
      console.log('üîç Checking for Emma Vault Extension...');
      
      // Check multiple ways extension might be detected
      const extensionMarker = document.getElementById('emma-vault-extension-marker');
      const windowExtension = window.EmmaVaultExtension;
      
      if (extensionMarker || windowExtension) {
        showExtensionDetected();
      } else {
        // Check again after a delay (extension might still be loading)
        setTimeout(() => {
          const laterCheck = document.getElementById('emma-vault-extension-marker') || window.EmmaVaultExtension;
          if (laterCheck) {
            showExtensionDetected();
          } else {
            showNoExtensionWarning();
          }
        }, 2000);
      }
      
      // Listen for extension ready event
      window.addEventListener('emma-vault-extension-ready', (event) => {
        console.log('üéâ Extension ready event received!');
        showExtensionDetected();
      });
    }
    
    function showExtensionDetected() {
      console.log('‚úÖ Emma Vault Extension detected!');
      
      const banner = document.getElementById('extensionDetectedBanner');
      const warning = document.getElementById('noExtensionWarning');
      
      if (banner) banner.classList.add('show');
      if (warning) warning.classList.remove('show');
      
      // Update vault buttons to mention extension
      const createBtn = document.querySelector('.emma-vault-btn');
      if (createBtn) {
        createBtn.innerHTML = 'üîó Use Extension to Manage Vault';
        createBtn.onclick = () => showExtensionGuide();
      }
      
      // Auto-redirect to dashboard after showing banner briefly
      console.log('üöÄ Extension detected - redirecting to dashboard in 3 seconds...');
      setTimeout(() => {
        console.log('üì± Redirecting to dashboard...');
        window.location.href = 'web-emma/working-desktop-dashboard.html';
      }, 3000);
      
      // Update banner to show countdown
      let countdown = 3;
      const countdownInterval = setInterval(() => {
        countdown--;
        if (banner) {
          banner.innerHTML = `
            <h3><span class="extension-icon">üîó</span>Emma Vault Extension Detected!</h3>
            <p>Redirecting to dashboard in ${countdown} seconds... <br>
            <small>Click anywhere to go now</small></p>
          `;
        }
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
        }
      }, 1000);
      
      // Allow immediate redirect on click
      if (banner) {
        banner.style.cursor = 'pointer';
        banner.onclick = () => {
          clearInterval(countdownInterval);
          window.location.href = 'web-emma/working-desktop-dashboard.html';
        };
      }
    }
    
    function showNoExtensionWarning() {
      console.log('‚ö†Ô∏è Emma Vault Extension not detected');
      
      const banner = document.getElementById('extensionDetectedBanner');
      const warning = document.getElementById('noExtensionWarning');
      
      if (banner) banner.classList.remove('show');
      if (warning) warning.classList.add('show');
    }
    
    function showExtensionInstallGuide() {
      alert(`üì¶ Emma Vault Extension Installation:

1. Install from Chrome Web Store (coming soon)
   OR
2. Developer install:
   - Download extension folder
   - Go to chrome://extensions
   - Enable "Developer mode"
   - Click "Load unpacked"
   - Select emma-vault-extension folder

3. Click the Emma extension icon üîí
4. Create or open your .emma vault
5. All changes auto-save to your file!

Perfect for Debbe - no passwords to remember! üíú`);
    }
    
    function showExtensionGuide() {
      alert(`üîó Using Emma Vault Extension:

1. Click the Emma extension icon üîí in your browser toolbar
2. Create a new vault or open an existing one
3. Add memories directly in the extension
4. Everything saves automatically to your .emma file!

The extension is your primary interface for vault management.
This web app provides additional features and experiences.

üíú Built with love for Debbe and all precious memories!`);
    }

    // Initialize Emma Web App
    console.log('üöÄ Emma Web App initialized - ready for your mother\'s precious memories!');
  </script>
</body>
</html>
